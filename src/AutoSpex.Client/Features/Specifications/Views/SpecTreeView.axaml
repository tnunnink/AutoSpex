<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:a="http://schemas.actiprosoftware.com/avaloniaui"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:specs="clr-namespace:AutoSpex.Client.Features.Specifications"
             xmlns:nodes="clr-namespace:AutoSpex.Client.Features.Nodes"
             d:DesignHeight="800" d:DesignWidth="400"
             x:Class="AutoSpex.Client.Features.Specifications.SpecTreeView"
             x:DataType="specs:SpecTreeViewModel"
             Background="{a:ThemeResource Container2BackgroundBrush}"
             BorderBrush="{a:ThemeResource Container2BorderBrush}">
    <Interaction.Behaviors>
        <EventTriggerBehavior EventName="Loaded">
            <InvokeCommandAction Command="{Binding GetNodesCommand}" />
        </EventTriggerBehavior>
    </Interaction.Behaviors>

    <Grid RowDefinitions="Auto, Auto, *">

        <!--Header Area-->
        <Border Grid.Row="0" Height="40"
                BorderBrush="{a:ThemeResource Container2BorderBrush}"
                BorderThickness="0 0 0 1">
            <DockPanel Margin="5" LastChildFill="True">

                <StackPanel DockPanel.Dock="Left"
                            Spacing="10">
                    <Button Command="{Binding AddCollectionCommand}"
                            Classes="icon"
                            ToolTip.Tip="New Collection">
                        <PathIcon Data="{StaticResource Icon.Add}"
                                  Classes="small" />
                    </Button>
                </StackPanel>

                <StackPanel DockPanel.Dock="Right"
                            Spacing="10">
                    <Button DockPanel.Dock="Right"
                            Classes="icon"
                            ToolTip.Tip="Options">
                        <PathIcon Data="{StaticResource Icon.Dots.Vertical}"
                                  Classes="small" />
                    </Button>
                </StackPanel>

                <Panel />

            </DockPanel>
        </Border>

        <!--Tree Area-->
        <Border Grid.Row="2">
            <TreeView x:Name="SpecTree"
                      ItemsSource="{Binding Nodes}"
                      SelectedItems="{Binding SelectedNodes}"
                      SelectedItem="{Binding SelectedNode}"
                      SelectionMode="Multiple"
                      VerticalAlignment="Stretch"
                      HorizontalAlignment="Stretch"
                      BorderThickness="0"
                      Background="Transparent"
                      PointerReleased="OnTreePointerReleased">
                <TreeView.ItemTemplate>
                    <TreeDataTemplate ItemsSource="{Binding Nodes}">
                        <StackPanel Spacing="10"
                                    Orientation="Horizontal">
                            <PathIcon Theme="{Binding NodeType, Converter={StaticResource NodeToIconConverter}}" />
                            <TextBlock Text="{Binding Name}"
                                       FontSize="12"
                                       VerticalAlignment="Center"
                                       TextTrimming="CharacterEllipsis"
                                       TextWrapping="NoWrap" />
                        </StackPanel>
                    </TreeDataTemplate>
                </TreeView.ItemTemplate>
                <TreeView.ItemContainerTheme>
                    <ControlTheme BasedOn="{StaticResource SpexTreeViewItem}"
                                  TargetType="TreeViewItem"
                                  x:DataType="nodes:Node">
                        <Setter Property="ContextFlyout"
                                Value="{Binding NodeType, Converter={StaticResource NodeToMenuConverter}}" />
                    </ControlTheme>
                </TreeView.ItemContainerTheme>
            </TreeView>
        </Border>
    </Grid>
</UserControl>